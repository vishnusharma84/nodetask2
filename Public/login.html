<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Login</h1>
      <p class="muted">Welcome back!</p>
      
      <form id="loginForm">
        <div>
          <label for="email">Email Address</label>
          <input type="email" id="email" name="email" required placeholder="Enter your email">
        </div>

        <div class="input-wrap">
          <label for="password">Password</label>
            <div class="password-field">
          <input type="password" id="password" name="password" required placeholder="Enter your password">
          <span class="toggle-password" onclick="togglePassword()">
            üëÅÔ∏è
          </span>
        </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary">Login</button>
          <button type="reset" class="btn-secondary">Clear</button>
        </div>
      </form>

      <p class="login-link">
        Don‚Äôt have an account? <a href="index.html">Register here</a>
      </p>
    </div>
  </div>

  <script>
     function togglePassword() {
    const passwordInput = document.getElementById("password");
    const toggleIcon = document.querySelector(".toggle-password");

    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      toggleIcon.textContent = "üôà"; // eye closed
    } else {
      passwordInput.type = "password";
      toggleIcon.textContent = "üëÅÔ∏è"; // eye open
    }
  }

  const socket = io();

  async function loadPage(url, scriptFile) {
    try {
      const res = await fetch(url);
      const html = await res.text();
      document.body.innerHTML = html;

    
      if (scriptFile) {
        const script = document.createElement("script");
        script.src = scriptFile;
        script.onload = () => console.log(scriptFile + " loaded ‚úÖ");
        document.body.appendChild(script);
      }
    } catch (err) {
      alert("Failed to load page: " + err.message);
    }
  }

  // Form submit
  $("#loginForm").on("submit", async function (e) {
    e.preventDefault();

    const email = $("#email").val().trim();
    const password = $("#password").val().trim();

    try {
      const res = await fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });

      const data = await res.json();

      if (data.success) {
        alert("Login Successful ‚úÖ");

  
        localStorage.setItem("user", JSON.stringify(data.user));
      localStorage.setItem("loggedInViaLogin", "true");

        socket.emit("join_live_users", data.user);

        await loadPage("view.html", "view.js");

      } else {
        alert("Invalid email or password ‚ùå");
      }
    } catch (err) {
      alert("Something went wrong: " + err.message);
    }
  });
</script>
</body>
</html>
